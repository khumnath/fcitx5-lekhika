#!/bin/bash
set -e

# Configuration
VERSION=latest
REPO="khumnath/fcitx5-lekhika/"
TMPDIR=$(mktemp -d)
INSTALL_DIR="/usr/lib/fcitx5"
DATA_DIR="/usr/share/fcitx5/fcitx5-lekhika"
ICON_DIR="/usr/share/icons/hicolor/48x48/apps"

echo "📥 Downloading prebuilt engine..."
cd "$TMPDIR"
curl -sL "https://github.com/$REPO/releases/$VERSION/download/fcitx5-lekhika.tar.gz" -o engine.tar.gz

echo "📦 Extracting..."
tar -xzf engine.tar.gz

echo "🧩 Installing engine and configuration..."
sudo install -Dm755 fcitx5lekhika.so "$INSTALL_DIR/fcitx5lekhika.so"
sudo install -Dm644 config/fcitx5lekhika.addon.conf /usr/share/fcitx5/addon/fcitx5lekhika.conf
sudo install -Dm644 config/fcitx5lekhika.inputmethod.intry.desc /usr/share/fcitx5/inputmethod/fcitx5lekhika.conf

echo "🗂️ Installing data files..."
sudo install -d "$DATA_DIR"
sudo install -m644 data/*.toml "$DATA_DIR"

echo "🎨 Installing icon..."
sudo install -Dm644 icons/48x48/apps/fcitx5-lekhika.png "$ICON_DIR/fcitx5-lekhika.png"

echo "✅ Installation complete. You may now activate 'fcitx5-lekhika' in fcitx5-configtool."

rm -rf "$TMPDIR"
